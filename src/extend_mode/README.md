# extend_mode 模块

## 功能描述
扩展模式核心模块，用于执行字符串映射流程，支持三种不同的子流程，处理不同场景下的字符串映射需求。

## 主要文件及其用途

| 文件名 | 用途 |
|--------|------|
| `__init__.py` | 模块初始化文件 |
| `core.py` | 扩展模式核心流程控制，包含run_extend_sub_flow函数 |

## 关键实现逻辑

### 三种子流程设计

1. **已有中文src文件夹映射流程**：
   - 适用于已有中文src文件夹的情况
   - 流程：加载中文src文件夹 → 提取字符串 → 生成映射规则 → 更新源代码

2. **没有中文src文件夹映射流程**：
   - 适用于没有中文src文件夹的情况
   - 流程：加载英文src文件夹 → 生成初始映射规则 → 手动编辑映射规则 → 更新源代码

3. **已有中文映射规则文件流程**：
   - 适用于已有中文映射规则文件的情况
   - 流程：加载英文src文件夹 → 加载已有映射规则 → 更新映射规则 → 更新源代码

### 核心流程控制

`run_extend_sub_flow`函数是扩展模式的核心入口，根据指定的子流程类型执行相应的流程，包括：
- 初始化流程
- 执行子流程
- 生成报告
- 保存结果

### 映射规则应用

使用YAML映射规则文件，根据映射规则更新源代码中的字符串，支持批量处理多个文件。

## 使用示例

### 执行扩展模式子流程

```python
from src.extend_mode.core import run_extend_sub_flow

# 执行已有中文src文件夹映射流程
result = run_extend_sub_flow(
    sub_flow="已有中文src文件夹映射流程",
    base_path="path/to/project"
)

# 执行没有中文src文件夹映射流程
result = run_extend_sub_flow(
    sub_flow="没有中文src文件夹映射流程",
    base_path="path/to/project"
)

# 执行已有中文映射规则文件流程
result = run_extend_sub_flow(
    sub_flow="已有中文映射规则文件流程",
    base_path="path/to/project"
)
```

### 从命令行执行

```bash
python src/main.py extend
```

## 依赖关系

- 依赖`src.common`模块，使用其提供的各种工具函数

## 开发和维护注意事项

1. **流程清晰**：保持子流程设计清晰，便于扩展新的子流程
2. **错误处理**：添加完善的错误处理和日志记录，便于调试和监控
3. **测试覆盖**：确保每个子流程都有对应的单元测试
4. **兼容性**：确保代码在不同操作系统下正常运行
5. **文档更新**：添加或修改子流程时，及时更新文档

## 测试

模块包含完整的单元测试，位于项目根目录的`test/`目录下，使用pytest进行测试。

### 运行测试

```bash
pytest test/
```
