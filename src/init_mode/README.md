# init_mode 模块

## 功能描述
初始化模式核心模块，包含程序启动时的所有初始化操作，确保后续的提取、映射和反编译流程能够正常进行。

## 主要文件及其用途

| 文件名 | 用途 |
|--------|------|
| `__init__.py` | 模块初始化文件 |
| `core.py` | 初始化模式核心流程控制，包含run_init_mode函数 |

## 关键实现逻辑

### 初始化操作

1. **文件夹结构创建**：自动创建程序执行所需的必要文件夹结构
2. **模组信息处理**：读取mod_info.json并自动重命名文件/文件夹
3. **文件夹重命名**：对source和source_backup目录下的mod文件夹进行重命名
4. **备份恢复**：从备份恢复文件，确保程序执行环境就绪

### 核心流程控制

`run_init_mode`函数是初始化模式的核心入口，执行以下操作：
- 创建必要的文件夹结构
- 处理模组信息
- 重命名模组文件夹
- 恢复备份文件
- 生成初始化报告

### 全局映射表

- **id_to_mod_info_mapping**：存储id到mod信息的映射关系
- **mod_mappings**：存储mod_id到mod_path和mod_info的完整映射
- **group_mappings**：存储mod_id到分组信息的映射

## 使用示例

### 执行初始化模式

```python
from src.init_mode.core import run_init_mode

# 执行初始化模式
result = run_init_mode()
print(result)
```

### 从命令行执行

```bash
python src/main.py init
```

## 依赖关系

- 依赖`src.common`模块，使用其提供的各种工具函数

## 开发和维护注意事项

1. **初始化顺序**：确保初始化操作的顺序正确，避免依赖问题
2. **错误处理**：添加完善的错误处理和日志记录，便于调试和监控
3. **测试覆盖**：确保初始化流程有对应的单元测试
4. **兼容性**：确保代码在不同操作系统下正常运行
5. **文档更新**：添加或修改初始化功能时，及时更新文档

## 测试

模块包含完整的单元测试，位于项目根目录的`test/`目录下，使用pytest进行测试。

### 运行测试

```bash
pytest test/
```