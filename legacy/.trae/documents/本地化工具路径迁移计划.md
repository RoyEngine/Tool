# 本地化工具路径迁移计划

## 一、问题分析

1. **路径混用问题**：系统同时使用传统路径(`${tool_root}\project`)和新路径(`${mod_root}\source`)
2. **自动检测逻辑**：目录映射器优先使用localization_file路径，不存在则回退到project目录
3. **硬编码路径**：代码中存在硬编码的传统路径引用
4. **功能异常**：部分功能因路径无法正常识别而失败

## 二、迁移目标

1. **统一路径体系**：所有功能模块统一使用新的路径体系
2. **移除传统路径**：彻底弃用`${tool_root}\project`等传统路径
3. **修复功能异常**：解决所有因路径问题导致的功能异常
4. **确保兼容性**：确保所有功能模块能通过新路径正常运行

## 三、迁移步骤

### 1. 更新配置文件

- **修改directory_config.json**：
  - 移除`project`目录配置
  - 确保所有路径都使用`${mod_root}`作为基础
  - 确保`rules`目录指向`${mod_root}\rule`
  - 确保`output`目录指向`${mod_root}\output`

- **修改directory_mapping.json**：
  - 移除所有`project`相关的映射
  - 确保所有模式都只使用`localization_file`映射
  - 移除自动回退到project目录的逻辑

### 2. 修改目录映射器

- **修改DirectoryMapper类**：
  - 移除自动检测逻辑，强制使用新路径
  - 移除project目录支持
  - 确保所有源目录都从`${mod_root}\source`获取

### 3. 修复硬编码路径

- **搜索并替换所有硬编码的传统路径**：
  - 替换`project/Extract/File`为`Localization_File/source`
  - 替换`project/Extend/File`为`Localization_File/source`
  - 替换`project/Extract/Strings`为`Localization_File/rule`
  - 替换`project/Extend/Strings`为`Localization_File/rule`

### 4. 修复功能模块

- **Extract模式**：
  - 确保从`Localization_File/source`读取源文件
  - 确保输出到`Localization_File/output/Extract_xxx`
  - 确保规则文件保存到`Localization_File/rule/xxx`

- **Extend模式**：
  - 确保从`Localization_File/source`读取源文件
  - 确保从`Localization_File/rule`读取映射规则
  - 确保输出到`Localization_File/output/Extend_xxx`

### 5. 测试验证

- **执行所有功能测试**：
  - Extract模式的英文提取流程
  - Extract模式的中文提取流程
  - Extract模式的JAR提取流程
  - Extend模式的英文映射到中文流程
  - Extend模式的中文映射到英文流程
  - 基于映射规则文件的映射流程

- **验证输出结果**：
  - 检查输出文件是否正确生成
  - 检查规则文件是否正确保存
  - 检查报告文件是否正确生成
  - 检查原始文件是否未被修改

## 四、预期结果

1. **所有功能模块正常运行**：不再出现任何与路径识别相关的错误
2. **统一使用新路径体系**：所有功能模块都使用`Localization_File`相关路径
3. **传统路径彻底弃用**：不再使用`project`等传统路径
4. **功能完整性保持**：所有原有功能都能正常工作
5. **报告输出正常**：所有报告文件都能正确生成

## 五、风险控制

1. **备份原始文件**：在修改前备份所有配置文件和代码
2. **逐步修改**：分阶段修改，确保每个阶段都能正常运行
3. **全面测试**：修改后进行全面测试，确保所有功能正常
4. **回滚机制**：如果出现严重问题，能够快速回滚到原始状态

## 六、实施时间表

1. **配置文件更新**：1小时
2. **目录映射器修改**：2小时
3. **硬编码路径修复**：3小时
4. **功能模块修复**：4小时
5. **测试验证**：2小时
6. **问题修复**：2小时

总计：约14小时

## 七、验收标准

1. **所有功能测试通过**：Extract和Extend模式的所有测试用例都能正常运行
2. **无路径相关错误**：日志中不再出现任何与路径识别相关的错误
3. **输出文件正确生成**：所有输出文件都能在预期位置生成
4. **原始文件未被修改**：source目录下的原始文件未被修改
5. **代码质量达标**：代码符合PEP 8规范，无硬编码路径

## 八、后续维护

1. **定期检查**：定期检查代码中是否引入新的硬编码路径
2. **更新文档**：更新用户文档，说明新的路径结构
3. **培训用户**：向用户介绍新的路径体系和使用方法
4. **持续优化**：根据用户反馈，持续优化路径结构和功能

通过以上步骤，我们可以确保本地化工具彻底迁移到新的路径体系，解决所有因路径问题导致的功能异常，确保所有功能模块都能正常运行。