# mod_info.json解析功能修复计划

## 一、问题分析

通过分析代码和终端日志，我发现了以下几个关键问题：

1. **JSON解析失败**：mod_info.json文件中包含注释，导致json.loads()解析失败
2. **注释处理不完整**：当前的注释处理逻辑无法处理所有类型的注释，特别是#开头的注释
3. **字符串识别不准确**：无法正确识别和提取JSON中的字符串内容
4. **依赖单一解析方式**：完全依赖json.loads()，没有备用解析方案

## 二、修复计划

### 1. 实现基于行的解析逻辑

**问题**：当前的JSON解析完全依赖json.loads()，无法处理带有复杂注释的JSON文件

**修复方案**：
- 修改_read_mod_info方法，添加基于行的解析逻辑
- 使用正则表达式提取每行中前两个双引号内的字符串
- 根据提取的字符串对，确定其对应的字段（id, name, version等）

**实施步骤**：
- 打开`src/init_mode/core.py`文件
- 修改ModInfo类的_read_mod_info方法
- 添加基于行的解析逻辑，使用正则表达式提取双引号内的字符串
- 实现字段识别逻辑，根据提取的字符串对确定字段类型

### 2. 增强注释处理逻辑

**问题**：当前的注释处理逻辑无法处理所有类型的注释，特别是#开头的注释

**修复方案**：
- 增强注释处理逻辑，支持更多类型的注释
- 确保在基于行的解析之前，所有注释都被正确移除

**实施步骤**：
- 在_read_mod_info方法中，增强注释处理逻辑
- 添加对#开头注释的支持
- 确保在提取字符串之前，所有注释都被正确移除

### 3. 重点处理前6行

**问题**：大部分必要信息通常出现在文件的前6行，但当前解析逻辑没有针对这一点进行优化

**修复方案**：
- 重点处理文件的前6行，确保提取到所有必要信息
- 对于前6行，使用更严格的解析逻辑

**实施步骤**：
- 在_read_mod_info方法中，添加对前6行的特殊处理
- 确保前6行被优先解析，并提取所有必要信息

### 4. 实现字段识别逻辑

**问题**：无法根据提取的字符串对确定其对应的字段

**修复方案**：
- 实现字段识别逻辑，根据提取的字符串对确定字段类型
- 支持id, name, version, author, description等字段的识别

**实施步骤**：
- 在_read_mod_info方法中，添加字段识别逻辑
- 根据提取的字符串对，确定其对应的字段
- 更新ModInfo对象的字段值

## 三、预期效果

1. 能够正确解析带有各种注释的mod_info.json文件
2. 能够提取每行中前两个双引号内的字符串内容
3. 能够根据提取的字符串对确定其对应的字段
4. 重点处理前6行，确保提取到所有必要信息
5. 不再完全依赖json.loads()，提高了解析的鲁棒性

## 四、验证计划

1. 使用带有各种注释的mod_info.json文件进行测试
2. 验证是否能够正确提取每行中前两个双引号内的字符串
3. 验证是否能够正确识别字段类型
4. 验证是否能够重点处理前6行，提取到所有必要信息
5. 验证是否能够成功解析并创建ModInfo对象