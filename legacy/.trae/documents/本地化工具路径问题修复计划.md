# 本地化工具路径问题修复计划

## 一、问题分析

通过分析代码和终端日志，我发现了以下几个关键问题：

1. **路径计算错误**：程序错误地将`Localization_File`目录识别为`Localization_Tool/Localization_File`，而实际上它应该是`legacy/Localization_File`
2. **文件夹重命名失败**：重命名函数在错误的路径下查找mod文件夹，导致无法找到需要重命名的文件夹
3. **路径生成机制过时**：程序中存在大量硬编码路径，没有根据当前项目结构正确更新
4. **硬编码路径过多**：代码库中存在大量硬编码路径，缺乏统一管理

## 二、修复计划

### 1. 修复路径计算问题

**问题**：`mod_root`被错误地解析为`Localization_Tool/Localization_File`，而不是`legacy/Localization_File`

**修复方案**：
- 修改`config_utils.py`中的路径计算逻辑，确保`script_dir`指向正确的基准目录
- 检查并修复`_resolve_directory_config`方法中的路径替换逻辑

**实施步骤**：
- 打开`src/common/config_utils.py`文件
- 修改第486行的`script_dir`计算逻辑，确保它指向`legacy`目录
- 验证`mod_root`是否被正确解析为`legacy/Localization_File`

### 2. 修复文件夹重命名问题

**问题**：重命名函数在错误的路径下查找mod文件夹，导致无法找到需要重命名的文件夹

**修复方案**：
- 确保`init_mode/core.py`中的重命名函数使用正确的`base_path`参数
- 检查`auto_rename_files_folders`和`rename_mod_folders`函数的路径处理逻辑

**实施步骤**：
- 打开`src/init_mode/core.py`文件
- 验证`run_init_tasks`函数中的`base_path`参数是否正确
- 检查`auto_rename_files_folders`和`rename_mod_folders`函数的路径生成逻辑
- 确保它们在正确的`Localization_File/source`和`Localization_File/source_backup`目录下查找文件夹

### 3. 修复路径生成机制

**问题**：程序中存在大量硬编码路径，没有根据当前项目结构正确更新

**修复方案**：
- 替换`main.py`中硬编码的路径，使用配置管理系统获取正确的路径
- 确保所有路径生成都通过配置管理系统进行

**实施步骤**：
- 打开`src/main.py`文件
- 修改`select_extract_sub_flow`和`select_extend_sub_flow`函数中的硬编码路径
- 改为使用`config_utils.py`中定义的函数来获取正确的路径
- 确保所有路径生成都通过配置管理系统进行

### 4. 迁移硬编码路径到配置文件

**问题**：代码库中存在大量硬编码路径，缺乏统一管理

**修复方案**：
- 识别代码库中所有硬编码路径，将它们迁移到`config/directory_config.json`配置文件中
- 更新所有使用硬编码路径的代码，改为使用配置管理系统获取路径

**实施步骤**：
- 搜索代码库中的所有硬编码路径
- 将这些路径迁移到`config/directory_config.json`配置文件中
- 更新所有使用硬编码路径的代码，改为使用`config_utils.py`中定义的函数来获取路径
- 确保所有路径引用都通过配置管理系统进行

## 三、验证计划

1. **验证路径计算**：运行程序，检查终端日志中的路径是否正确
2. **验证文件夹重命名**：在`Localization_File/source`目录下创建测试mod文件夹，运行程序，检查是否能正确重命名
3. **验证路径生成机制**：运行程序，检查所有路径引用是否正确
4. **验证硬编码路径迁移**：搜索代码库，确保没有遗漏的硬编码路径

## 四、预期效果

1. 程序能够正确识别`Localization_File`目录的位置
2. 文件夹重命名功能能够正常工作
3. 所有路径引用都通过配置管理系统进行，便于维护和更新
4. 代码库中的硬编码路径数量显著减少，提高了代码的可维护性和灵活性