# 项目重构计划

## 1. 项目结构重构

### 1.1 创建新的文件夹结构

**当前结构**：
```
src/
├── common/
├── extend_mode/
├── extract_mode/
└── main.py
```

**重构后结构**：
```
src/
├── common/
├── extend_mode/       # 仅保留映射和后续处理功能
├── extract_mode/      # 仅保留字符串提取功能
├── decompile_mode/    # 新增：专门用于文件反编译操作
├── init_mode/         # 新增：用于程序启动时的初始化操作
└── main.py
```

### 1.2 功能范围调整

**1.2.1 extract_mode 调整**
- 移除：反编译功能调用
- 保留：从源文件提取字符串的功能
- 调整：专注于字符串提取和映射规则生成

**1.2.2 extend_mode 调整**
- 移除：所有与反编译相关的功能
- 保留：映射和后续处理功能
- 调整：专注于使用映射规则进行文件处理

**1.2.3 新增 decompile_mode**
- 功能：专门负责文件反编译操作
- 包含：jar文件反编译、文件提取等功能
- 依赖：src/common/jar_utils.py

**1.2.4 新增 init_mode**
- 功能：程序启动时的初始化操作
- 包含：
  - 自动创建必要的文件夹结构
  - 读取mod_info.json并自动重命名文件/文件夹

## 2. 自动执行核心任务实现

### 2.1 自动创建必要的文件夹结构

**实现位置**：`src/init_mode/core.py`

**功能**：
- 检查项目根目录下的文件夹结构
- 创建缺失的必要文件夹
- 确保所有模块正常运行所需的目录存在

### 2.2 自动重命名文件/文件夹

**实现位置**：`src/init_mode/core.py`

**功能**：
- 遍历mod文件夹
- 读取mod_info.json文件
- 提取name和version字段
- 根据提取的信息重命名相关文件或文件夹

## 3. 实现步骤

### 3.1 创建新的文件夹和核心文件

1. 创建 `src/decompile_mode` 文件夹和 `core.py` 文件
2. 创建 `src/init_mode` 文件夹和 `core.py` 文件
3. 为新文件夹创建 `__init__.py` 文件

### 3.2 调整现有模块功能

1. **调整 extract_mode**：
   - 移除 `decompile_jar` 调用
   - 移除相关反编译逻辑

2. **调整 extend_mode**：
   - 移除所有与反编译相关的功能
   - 确保只保留映射和后续处理功能

### 3.3 实现 decompile_mode 功能

1. 将 `src/common/jar_utils.py` 中的反编译相关功能迁移到 `decompile_mode/core.py`
2. 实现文件提取功能
3. 确保与其他模块的接口清晰

### 3.4 实现 init_mode 功能

1. 实现自动创建文件夹结构的功能
2. 实现自动重命名文件/文件夹的功能
3. 确保在程序启动时自动执行

### 3.5 修改 main.py

1. 在程序启动时调用 init_mode 的功能
2. 调整模块导入关系
3. 确保重构后的程序能够正常运行

## 4. 测试与验证

1. 测试程序启动时是否自动创建必要的文件夹结构
2. 测试是否自动读取mod_info.json并正确重命名文件/文件夹
3. 测试extract_mode是否能正常提取字符串
4. 测试extend_mode是否能正常执行映射流程
5. 测试decompile_mode是否能正常执行反编译操作

## 5. 预期效果

1. 项目结构更加清晰，功能模块划分明确
2. 程序启动时自动完成初始化操作，简化用户流程
3. 各模块功能单一，便于维护和扩展
4. 反编译功能集中管理，提高代码复用性
5. 自动重命名功能简化用户操作，减少手动干预

## 6. 注意事项

1. 确保重构后各模块之间的依赖关系清晰
2. 保持向后兼容性，确保现有功能不受影响
3. 确保日志记录功能正常
4. 确保错误处理机制完善
5. 确保所有功能都有适当的文档说明