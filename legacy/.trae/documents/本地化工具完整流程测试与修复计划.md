# 本地化工具完整流程测试与修复计划

## 1. 问题识别

通过对代码的全面分析，我发现了以下需要修复的问题：

1. **硬编码路径问题**：在`extract_mode/core.py`和`extend_mode/core.py`中仍然存在传统路径的硬编码
2. **mod_name解析问题**：当前直接使用文件夹名作为mod_name，而非从`mod_info.json`的`name`和`version`字段组合
3. **输出路径格式问题**：输出路径构建不符合文档指定的格式
4. **路径体系混用**：部分函数同时使用传统路径和新路径体系

## 2. 修复计划

### 2.1 修复硬编码路径

**文件**：`extract_mode/core.py`
- 将`_process_existing_english_src`、`_process_no_english_src`、`_process_existing_chinese_src`、`_process_no_chinese_src`等函数中的传统路径替换为新路径体系
- 移除所有`os.path.join(base_path, "project", ...)`格式的路径

**文件**：`extend_mode/core.py`
- 将`_process_existing_chinese_src`、`_process_no_chinese_src`、`_process_existing_chinese_rules`等函数中的传统路径替换为新路径体系
- 移除所有`os.path.join(base_path, "project", ...)`格式的路径

### 2.2 改进mod_name解析逻辑

**文件**：`extract_mode/core.py`和`extend_mode/core.py`
- 修改`_extract_strings_from_source`函数，从`mod_info.json`中提取`name`和`version`字段组合作为mod_name
- 修改`_build_mod_mapping`函数，使用正确的mod_name构建映射关系
- 修改输出路径构建逻辑，使用正确的mod_name

### 2.3 调整输出路径构建

**文件**：`extract_mode/core.py`和`extend_mode/core.py`
- 确保输出路径符合文档格式：`Localization_File/output/Extract_English/mod_name/`
- 移除输出路径中的时间戳前缀，改为直接使用mod_name
- 确保报告文件和映射规则文件正确生成到指定路径

### 2.4 统一路径体系

**文件**：所有涉及路径操作的文件
- 确保所有函数都使用新的路径体系
- 使用`get_directory`和`get_source_directory`等工具函数获取路径
- 确保路径解析和构建的一致性

## 3. 测试计划

### 3.1 Extract模式测试

1. **英文提取测试**：
   - 输入：`Localization_File/source/English/mod_name/src/`
   - 预期输出：`Localization_File/output/Extract_English/mod_name/`包含映射规则和报告

2. **中文提取测试**：
   - 输入：`Localization_File/source/Chinese/mod_name/src/`
   - 预期输出：`Localization_File/output/Extract_Chinese/mod_name/`包含映射规则和报告

3. **JAR提取测试**：
   - 输入：`Localization_File/source/English/mod_name/mod.jar`
   - 预期输出：自动反编译并提取字符串，生成映射规则和报告

### 3.2 Extend模式测试

1. **英文到中文映射测试**：
   - 输入：`Localization_File/source/English/mod_name/src/`和映射规则
   - 预期输出：`Localization_File/output/Extend_en2zh/mod_name/`包含映射后的源文件和报告

2. **中文到英文映射测试**：
   - 输入：`Localization_File/source/Chinese/mod_name/src/`和映射规则
   - 预期输出：`Localization_File/output/Extend_zh2en/mod_name/`包含映射后的源文件和报告

### 3.3 路径正确性验证

1. 验证工具不会修改原始文件夹
2. 验证所有输出都生成到正确的`Localization_File`目录
3. 验证`mod_name`正确从`mod_info.json`解析
4. 验证没有多余文件夹创建

## 4. 验证标准

1. **功能完整性**：所有流程能够完整执行
2. **路径正确性**：所有文件操作都在指定目录进行
3. **输出完整性**：生成预期的输出文件和报告
4. **性能稳定性**：工具运行稳定，无崩溃或错误
5. **结果准确性**：生成的映射规则和报告内容准确

## 5. 执行步骤

1. 修复代码中的硬编码路径
2. 改进mod_name解析逻辑
3. 调整输出路径构建
4. 统一路径体系
5. 执行Extract模式测试
6. 执行Extend模式测试
7. 验证测试结果
8. 修复发现的问题
9. 最终验证

## 6. 预期结果

通过以上修复和测试，本地化工具将能够：

1. 正确识别和使用`Localization_File`目录结构
2. 从`mod_info.json`正确解析mod_name
3. 生成符合文档格式的输出路径和文件
4. 完整执行Extract和Extend模式的所有流程
5. 生成准确的映射规则和报告
6. 不修改原始文件夹
7. 不创建多余文件夹
8. 稳定运行，无错误或崩溃

这个计划将确保本地化工具符合所有指定的要求，并能够正确执行完整的本地化流程。