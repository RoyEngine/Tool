# 脚本与核心模块功能重复分析报告

## 1. 核心功能实现逻辑对比

### generate_mapping_rules.py
- 从源目录或已处理文件夹提取映射规则
- 合并现有规则与新提取的规则
- 生成带有未映射标记的YAML规则文件

### process_unmapped.py
- 生成未映射内容报告
- 列出所有未映射内容
- 将未映射内容标记为已翻译

### src/common/yaml_utils.py
- YAML映射文件的加载、验证和应用
- 映射规则的生成、更新和合并
- 冲突检测和解决
- 版本控制和备份

### src/common/tree_sitter_utils.py
- Tree-sitter AST解析
- 字符串提取和上下文信息提取
- 支持Java、Kotlin和Python文件

## 2. 函数调用关系分析

### generate_mapping_rules.py 调用的核心函数
```
src/common/yaml_utils.py:
- extract_mappings_from_processed_folder
- create_yaml_mapping_from_directory
- save_yaml_mappings
- load_yaml_mappings
- generate_initial_yaml_mappings
- update_mapping_status
- merge_mapping_rules

src/common/tree_sitter_utils.py:
- extract_ast_mappings
```

### process_unmapped.py 调用的核心函数
```
src/common/yaml_utils.py:
- load_yaml_mappings
- save_yaml_mappings
- update_mapping_status
- RuleConflictDetector (类)
```

## 3. 功能重叠评估

### 无直接代码重复
- 两个脚本都是通过导入和调用`src/common`目录下的模块来实现功能
- 脚本本身没有实现与核心模块中相同的功能

### 功能划分清晰
- `src/common/`目录下的模块提供核心功能库
- 脚本作为命令行工具，调用核心库实现特定工作流

### 输入输出格式一致
- 所有模块都处理类似的映射规则格式（id、original、translated、context、status等）
- 都基于文件操作，处理YAML格式的映射规则文件

## 4. 优化建议

### 1. 整合命令行工具
- 将两个脚本的功能整合到一个统一的命令行工具中
- 提供子命令方式：`localization-tool extract`、`localization-tool process-unmapped`
- 共享命令行参数处理逻辑

### 2. 提取公共工具函数
- 将脚本中相似的日志输出、错误处理逻辑提取到`src/common`模块
- 统一输出格式化逻辑

### 3. 增强核心模块功能
- 在`yaml_utils.py`中添加未映射内容报告生成功能
- 扩展`RuleConflictDetector`类，添加更多冲突检测类型
- 增强`update_mapping_status`函数，支持更多状态更新策略

### 4. 改进模块依赖关系
- 减少模块间的循环依赖（如`yaml_utils.py`导入`tree_sitter_utils.py`）
- 考虑使用依赖注入或更清晰的分层架构

## 5. 结论

- 两个脚本与`src`文件夹中的核心模块之间**没有直接的代码重复**
- 功能划分清晰，脚本是核心模块的客户端，调用核心模块提供的API
- 存在一些可以优化的地方，主要是整合命令行工具和提取公共逻辑
- 建议将脚本功能整合到一个统一的命令行工具中，提供更一致的用户体验

通过以上优化，可以减少代码冗余，提高代码可维护性，并提供更统一的用户体验。