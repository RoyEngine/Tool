# 本地化工具测试计划

## 一、测试目标
执行本地化工具中的每一个完整流程，确保完整运行并验证最终结果的正确性，包括：
1. Extract模式：从源代码或JAR文件提取字符串
2. Extend模式：使用映射规则执行字符串映射
3. 验证所有输出文件的创建、修改或删除
4. 验证文件内容的准确性和完整性
5. 确保原始文件夹不被破坏

## 二、测试环境
- 测试目录：D:\Poki\Tool\Localization_File
- 测试工具：Python 3.x
- 操作系统：Windows

## 三、测试内容

### 1. Extract模式测试

#### 1.1 英文提取流程
- **测试输入**：source/English/SecondInCommand-1.8.0/src/
- **测试步骤**：
  1. 执行英文提取流程
  2. 验证输出文件：
     - output/Extract_English/[timestamp]_SecondInCommand-1.8.0/English_mappings.json
     - output/Extract_English/[timestamp]_SecondInCommand-1.8.0/English_mappings.yaml
     - output/Extract_English/[timestamp]_SecondInCommand-1.8.0/extract_[timestamp]_report.json
     - output/Extract_English/[timestamp]_SecondInCommand-1.8.0/mod_info.json
     - rule/English/SecondInCommand-1.8.0/English_mappings.json
     - rule/English/SecondInCommand-1.8.0/English_mappings.yaml
  3. 验证source/English/SecondInCommand-1.8.0/目录未被修改

#### 1.2 中文提取流程
- **测试输入**：source/Chinese/SecondInCommand/src/
- **测试步骤**：
  1. 执行中文提取流程
  2. 验证输出文件：
     - output/Extract_Chinese/[timestamp]_SecondInCommand/Chinese_mappings.json
     - output/Extract_Chinese/[timestamp]_SecondInCommand/Chinese_mappings.yaml
     - output/Extract_Chinese/[timestamp]_SecondInCommand/extract_[timestamp]_report.json
     - output/Extract_Chinese/[timestamp]_SecondInCommand/mod_info.json
     - rule/Chinese/SecondInCommand/Chinese_mappings.json
     - rule/Chinese/SecondInCommand/Chinese_mappings.yaml
  3. 验证source/Chinese/SecondInCommand/目录未被修改

#### 1.3 英文JAR提取流程
- **测试输入**：source/English/SecondInCommand-1.8.0/jars/SecondInCommand.jar
- **测试步骤**：
  1. 执行英文提取流程(无src文件夹)
  2. 验证输出：
     - 自动创建jar文件夹并反编译
     - 生成映射规则文件
  3. 验证source/English/SecondInCommand-1.8.0/目录未被修改

#### 1.4 中文JAR提取流程
- **测试输入**：source/Chinese/SecondInCommand/jars/SecondInCommand.jar
- **测试步骤**：
  1. 执行中文提取流程(无src文件夹)
  2. 验证输出：
     - 自动创建jar文件夹并反编译
     - 生成映射规则文件
  3. 验证source/Chinese/SecondInCommand/目录未被修改

### 2. Extend模式测试

#### 2.1 英文映射到中文流程
- **测试输入**：
  - source/English/SecondInCommand-1.8.0/src/
  - rule/Chinese/SecondInCommand/Chinese_mappings.yaml
- **测试步骤**：
  1. 执行英文映射到中文流程
  2. 验证输出：
     - output/Extend_en2zh/[timestamp]_SecondInCommand-1.8.0/ 目录
     - 映射后的源文件
     - Chinese_mappings.json/yaml
     - extend_[timestamp]_report.json
     - mod_info.json
  3. 验证source/English/SecondInCommand-1.8.0/目录未被修改

#### 2.2 中文映射到英文流程
- **测试输入**：
  - source/Chinese/SecondInCommand/src/
  - rule/English/SecondInCommand-1.8.0/English_mappings.yaml
- **测试步骤**：
  1. 执行中文映射到英文流程
  2. 验证输出：
     - output/Extend_zh2en/[timestamp]_SecondInCommand/ 目录
     - 映射后的源文件
     - English_mappings.json/yaml
     - extend_[timestamp]_report.json
     - mod_info.json
  3. 验证source/Chinese/SecondInCommand/目录未被修改

#### 2.3 基于映射规则文件的映射流程
- **测试输入**：
  - source/English/SecondInCommand-1.8.0/src/
  - rule/Chinese/SecondInCommand/Chinese_mappings.yaml
- **测试步骤**：
  1. 执行已有映射规则文件流程
  2. 验证输出文件的正确性
  3. 验证source/English/SecondInCommand-1.8.0/目录未被修改

## 四、验证标准

1. **文件存在性验证**：
   - 所有预期输出文件必须存在
   - 目录结构符合预期

2. **文件内容验证**：
   - 映射规则文件包含正确的字符串映射
   - 报告文件包含完整的执行信息
   - 映射后的源文件包含正确的目标语言字符串

3. **流程完整性验证**：
   - 流程执行无错误
   - 所有步骤按预期完成
   - 耗时合理

4. **原始文件保护验证**：
   - 原始source目录下的文件未被修改
   - 原始rule目录下的文件未被修改
   - 仅输出目录和临时目录被修改

## 五、测试执行顺序

1. 首先执行Extract模式测试，生成映射规则文件
2. 然后执行Extend模式测试，使用生成的映射规则文件
3. 最后验证所有输出结果和原始文件完整性

## 六、测试工具

- Python脚本：用于自动化测试和验证
- 文件比较工具：用于验证文件内容的准确性
- 日志分析工具：用于分析执行日志

## 七、测试结果报告

测试完成后，将生成详细的测试报告，包括：
- 每个测试用例的执行结果
- 成功/失败统计
- 错误信息和分析
- 改进建议

## 八、注意事项

1. 所有测试操作必须对实际文件系统进行真实读写
2. 测试前备份原始文件，测试后验证备份完整性
3. 严格按照工具要求的目录结构组织测试文件
4. 记录所有测试步骤和结果
5. 确保测试环境的一致性和可重复性
6. 重点验证原始文件夹未被修改

## 九、紧急恢复方案

如果测试过程中出现意外情况，导致原始文件夹被修改，可以使用以下恢复方案：

1. 使用工具自带的`fix_source_directory`函数恢复source目录
2. 使用备份文件手动恢复
3. 重新从原始来源获取测试文件